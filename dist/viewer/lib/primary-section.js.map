{
  "version": 3,
  "sources": ["../../../src/viewer/lib/primary-section.ts"],
  "sourcesContent": ["const HERO_SECTION_REGEX = /<section[^>]*id=([\"'])hero\\1[\\s\\S]*?<\\/section>/i;\nconst MAIN_SECTION_REGEX = /<main[\\s\\S]*?<\\/main>/i;\n\nexport interface ExtractionResult {\n  sanitizedHtml: string;\n  rawSection: string;\n}\n\nexport function extractPrimarySection(responseText: string): ExtractionResult {\n  const heroMatch = HERO_SECTION_REGEX.exec(responseText);\n  const rawSection = heroMatch?.[0] ?? extractFallbackSection(responseText) ?? responseText;\n  const normalized = normalizeSection(rawSection);\n  return { sanitizedHtml: normalized, rawSection };\n}\n\nfunction extractFallbackSection(source: string): string | null {\n  const mainMatch = MAIN_SECTION_REGEX.exec(source);\n  if (mainMatch?.[0]) {\n    return mainMatch[0];\n  }\n  return source.trim() || null;\n}\n\nfunction normalizeSection(section: string): string {\n  if (!section) return \"\";\n  let output = section;\n  output = stripJsxArtifacts(output);\n  output = convertClassBindings(output);\n  output = convertCustomComponents(output);\n  output = sanitizeMarkup(output);\n  return output;\n}\n\nfunction stripJsxArtifacts(source: string): string {\n  return source\n    .replace(/\\{\\s*\\/\\*[\\s\\S]*?\\*\\/\\s*\\}/g, \"\") // strip comments\n    .replace(/\\{\\s*[\"'`]\\s*\\}/g, \" \") // strip empty spaces\n    .replace(/\\{\\s*`([^`]+)`\\s*\\}/g, (_, text) => text) // inline template strings\n    .replace(/\\{\\s*\"([^\"]+)\"\\s*\\}/g, (_, text) => text)\n    .replace(/\\{\\s*'([^']+)'\\s*\\}/g, (_, text) => text)\n    .replace(/<>/g, '<div class=\"arena-fragment\">')\n    .replace(/<\\/>/g, \"</div>\");\n}\n\nfunction convertClassBindings(source: string): string {\n  return source\n    .replace(/className=/g, \"class=\")\n    .replace(/class=\\{\\s*`([^`]+)`\\s*\\}/g, (_, classes) => `class=\"${classes}\"`)\n    .replace(/class=\\{\\s*\"([^\"]+)\"\\s*\\}/g, (_, classes) => `class=\"${classes}\"`)\n    .replace(/class=\\{\\s*'([^']+)'\\s*\\}/g, (_, classes) => `class=\"${classes}\"`)\n    .replace(/class=\\{\\s*([^}]+)\\s*\\}/g, (_, expr) => {\n      return `class=\"${expr\n        .split(/[\\s+|]+/)\n        .map((token: string) => token.replace(/[\"'`]/g, \"\").trim())\n        .filter(Boolean)\n        .join(\" \")}\"`;\n    });\n}\n\nfunction convertCustomComponents(source: string): string {\n  let output = source;\n\n  output = replaceComponent(output, \"Button\", \"button\", \"arena-btn\", [\"variant\", \"size\", \"asChild\"]);\n  output = replaceComponent(output, \"Badge\", \"span\", \"arena-badge\");\n  output = replaceComponent(output, \"Card\", \"div\", \"arena-card\");\n  output = replaceComponent(output, \"CardHeader\", \"div\", \"arena-card__header\");\n  output = replaceComponent(output, \"CardContent\", \"div\", \"arena-card__content\");\n  output = replaceComponent(output, \"CardTitle\", \"h3\", \"arena-card__title\");\n  output = replaceComponent(output, \"CardDescription\", \"p\", \"arena-card__description\");\n  output = replaceComponent(output, \"CardFooter\", \"div\", \"arena-card__footer\");\n  output = replaceComponent(output, \"Tabs\", \"div\", \"arena-tabs\");\n  output = replaceComponent(output, \"TabsList\", \"div\", \"arena-tabs__list\");\n  output = replaceComponent(output, \"TabsTrigger\", \"button\", \"arena-tabs__trigger\", [\"value\"]);\n  output = replaceComponent(output, \"TabsContent\", \"div\", \"arena-tabs__content\", [\"value\"]);\n  output = replaceComponent(output, \"Link\", \"a\", \"arena-link\", [\"prefetch\", \"legacyBehavior\"]);\n  output = replaceComponent(output, \"Input\", \"input\", \"arena-input\", [\"type\"]);\n  output = replaceComponent(output, \"Label\", \"label\", \"arena-label\");\n  output = replaceComponent(output, \"Textarea\", \"textarea\", \"arena-textarea\");\n  output = replaceComponent(output, \"Avatar\", \"div\", \"arena-avatar\");\n  output = replaceComponent(output, \"AvatarImage\", \"div\", \"arena-avatar__image\", [\"src\", \"alt\"]);\n  output = replaceComponent(output, \"AvatarFallback\", \"span\", \"arena-avatar__fallback\");\n  output = replaceSelfClosing(output, \"Image\", \"div\", \"arena-image\", [\"src\", \"alt\", \"width\", \"height\"]);\n\n  return output;\n}\n\nfunction replaceComponent(\n  source: string,\n  componentName: string,\n  tagName: string,\n  baseClass: string,\n  stripAttrs: string[] = [],\n): string {\n  const openingTagRegex = new RegExp(`<${componentName}([^>]*)>`, \"g\");\n  const closingTagRegex = new RegExp(`</${componentName}>`, \"g\");\n\n  const transformAttrs = (attrs: string) => buildTagAttributes(attrs, baseClass, stripAttrs);\n\n  return source\n    .replace(openingTagRegex, (_, attrs) => `<${tagName}${transformAttrs(attrs)}>`)\n    .replace(closingTagRegex, `</${tagName}>`);\n}\n\nfunction replaceSelfClosing(source: string, componentName: string, tagName: string, baseClass: string, keepAttrs: string[] = []): string {\n  const regex = new RegExp(`<${componentName}([^>]*)/>`, \"g\");\n  return source.replace(regex, (_, attrs) => {\n    const mapped = buildTagAttributes(attrs, baseClass, [], keepAttrs);\n    return `<${tagName}${mapped}></${tagName}>`;\n  });\n}\n\nfunction buildTagAttributes(attrs: string, baseClass: string, stripAttrs: string[] = [], keepOnly?: string[]): string {\n  const parsed = parseAttributes(attrs ?? \"\");\n\n  for (const key of stripAttrs) {\n    delete parsed[key];\n  }\n\n  if (keepOnly && keepOnly.length > 0) {\n    for (const key of Object.keys(parsed)) {\n      if (!keepOnly.includes(key)) {\n        delete parsed[key];\n      }\n    }\n  }\n\n  const classes: string[] = [baseClass];\n  if (parsed.className) {\n    classes.push(...splitClasses(parsed.className));\n    delete parsed.className;\n  }\n  if (parsed.class) {\n    classes.push(...splitClasses(parsed.class));\n    delete parsed.class;\n  }\n\n  const attrPairs = Object.entries(parsed)\n    .map(([key, value]) => `${key}=\"${escapeAttribute(value)}\"`)\n    .join(\" \");\n\n  return ` class=\"${classes.filter(Boolean).join(\" \")}\"${attrPairs ? ` ${attrPairs}` : \"\"}`;\n}\n\nfunction parseAttributes(source: string): Record<string, string> {\n  const attrs: Record<string, string> = {};\n  const regex = /([a-zA-Z_:][a-zA-Z0-9_:.-]*)\\s*=\\s*({[^}]*}|\"[^\"]*\"|'[^']*')/g;\n  let match: RegExpExecArray | null;\n  while ((match = regex.exec(source))) {\n    const [, key, rawValue] = match;\n    attrs[key] = unwrapAttributeValue(rawValue);\n  }\n  return attrs;\n}\n\nfunction unwrapAttributeValue(value: string): string {\n  const trimmed = value.trim();\n  if (!trimmed) return \"\";\n  if ((trimmed.startsWith(\"{\") && trimmed.endsWith(\"}\")) || (trimmed.startsWith(\"(\") && trimmed.endsWith(\")\"))) {\n    return trimmed.slice(1, -1).trim();\n  }\n  if ((trimmed.startsWith('\"') && trimmed.endsWith('\"')) || (trimmed.startsWith(\"'\") && trimmed.endsWith(\"'\"))) {\n    return trimmed.slice(1, -1);\n  }\n  return trimmed;\n}\n\nfunction splitClasses(value: string | undefined): string[] {\n  if (!value) return [];\n  return value\n    .replace(/[`\"'{}]/g, \" \")\n    .split(/\\s+/)\n    .filter(Boolean);\n}\n\nfunction escapeAttribute(value: string): string {\n  return value\n    .replace(/&/g, \"&amp;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\");\n}\n\nfunction sanitizeMarkup(source: string): string {\n  return source\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, \"\")\n    .replace(/\\son[a-z]+\\s*=\\s*\"[^\"]*\"/gi, \"\")\n    .replace(/\\son[a-z]+\\s*=\\s*'[^']*'/gi, \"\")\n    .replace(/\\son[a-z]+\\s*=\\s*\\{[^}]*\\}/gi, \"\")\n    .replace(/style=\\{[^}]*\\}/gi, \"\")\n    .replace(/style=\"[^\"]*\"/gi, \"\")\n    .replace(/style='[^']*'/gi, \"\");\n}\n\n"],
  "mappings": "AAAA,MAAM,qBAAqB;AAC3B,MAAM,qBAAqB;AAOpB,SAAS,sBAAsB,cAAwC;AAC5E,QAAM,YAAY,mBAAmB,KAAK,YAAY;AACtD,QAAM,aAAa,YAAY,CAAC,KAAK,uBAAuB,YAAY,KAAK;AAC7E,QAAM,aAAa,iBAAiB,UAAU;AAC9C,SAAO,EAAE,eAAe,YAAY,WAAW;AACjD;AAEA,SAAS,uBAAuB,QAA+B;AAC7D,QAAM,YAAY,mBAAmB,KAAK,MAAM;AAChD,MAAI,YAAY,CAAC,GAAG;AAClB,WAAO,UAAU,CAAC;AAAA,EACpB;AACA,SAAO,OAAO,KAAK,KAAK;AAC1B;AAEA,SAAS,iBAAiB,SAAyB;AACjD,MAAI,CAAC,QAAS,QAAO;AACrB,MAAI,SAAS;AACb,WAAS,kBAAkB,MAAM;AACjC,WAAS,qBAAqB,MAAM;AACpC,WAAS,wBAAwB,MAAM;AACvC,WAAS,eAAe,MAAM;AAC9B,SAAO;AACT;AAEA,SAAS,kBAAkB,QAAwB;AACjD,SAAO,OACJ,QAAQ,+BAA+B,EAAE,EACzC,QAAQ,oBAAoB,GAAG,EAC/B,QAAQ,wBAAwB,CAAC,GAAG,SAAS,IAAI,EACjD,QAAQ,wBAAwB,CAAC,GAAG,SAAS,IAAI,EACjD,QAAQ,wBAAwB,CAAC,GAAG,SAAS,IAAI,EACjD,QAAQ,OAAO,8BAA8B,EAC7C,QAAQ,SAAS,QAAQ;AAC9B;AAEA,SAAS,qBAAqB,QAAwB;AACpD,SAAO,OACJ,QAAQ,eAAe,QAAQ,EAC/B,QAAQ,8BAA8B,CAAC,GAAG,YAAY,UAAU,OAAO,GAAG,EAC1E,QAAQ,8BAA8B,CAAC,GAAG,YAAY,UAAU,OAAO,GAAG,EAC1E,QAAQ,8BAA8B,CAAC,GAAG,YAAY,UAAU,OAAO,GAAG,EAC1E,QAAQ,4BAA4B,CAAC,GAAG,SAAS;AAChD,WAAO,UAAU,KACd,MAAM,SAAS,EACf,IAAI,CAAC,UAAkB,MAAM,QAAQ,UAAU,EAAE,EAAE,KAAK,CAAC,EACzD,OAAO,OAAO,EACd,KAAK,GAAG,CAAC;AAAA,EACd,CAAC;AACL;AAEA,SAAS,wBAAwB,QAAwB;AACvD,MAAI,SAAS;AAEb,WAAS,iBAAiB,QAAQ,UAAU,UAAU,aAAa,CAAC,WAAW,QAAQ,SAAS,CAAC;AACjG,WAAS,iBAAiB,QAAQ,SAAS,QAAQ,aAAa;AAChE,WAAS,iBAAiB,QAAQ,QAAQ,OAAO,YAAY;AAC7D,WAAS,iBAAiB,QAAQ,cAAc,OAAO,oBAAoB;AAC3E,WAAS,iBAAiB,QAAQ,eAAe,OAAO,qBAAqB;AAC7E,WAAS,iBAAiB,QAAQ,aAAa,MAAM,mBAAmB;AACxE,WAAS,iBAAiB,QAAQ,mBAAmB,KAAK,yBAAyB;AACnF,WAAS,iBAAiB,QAAQ,cAAc,OAAO,oBAAoB;AAC3E,WAAS,iBAAiB,QAAQ,QAAQ,OAAO,YAAY;AAC7D,WAAS,iBAAiB,QAAQ,YAAY,OAAO,kBAAkB;AACvE,WAAS,iBAAiB,QAAQ,eAAe,UAAU,uBAAuB,CAAC,OAAO,CAAC;AAC3F,WAAS,iBAAiB,QAAQ,eAAe,OAAO,uBAAuB,CAAC,OAAO,CAAC;AACxF,WAAS,iBAAiB,QAAQ,QAAQ,KAAK,cAAc,CAAC,YAAY,gBAAgB,CAAC;AAC3F,WAAS,iBAAiB,QAAQ,SAAS,SAAS,eAAe,CAAC,MAAM,CAAC;AAC3E,WAAS,iBAAiB,QAAQ,SAAS,SAAS,aAAa;AACjE,WAAS,iBAAiB,QAAQ,YAAY,YAAY,gBAAgB;AAC1E,WAAS,iBAAiB,QAAQ,UAAU,OAAO,cAAc;AACjE,WAAS,iBAAiB,QAAQ,eAAe,OAAO,uBAAuB,CAAC,OAAO,KAAK,CAAC;AAC7F,WAAS,iBAAiB,QAAQ,kBAAkB,QAAQ,wBAAwB;AACpF,WAAS,mBAAmB,QAAQ,SAAS,OAAO,eAAe,CAAC,OAAO,OAAO,SAAS,QAAQ,CAAC;AAEpG,SAAO;AACT;AAEA,SAAS,iBACP,QACA,eACA,SACA,WACA,aAAuB,CAAC,GAChB;AACR,QAAM,kBAAkB,IAAI,OAAO,IAAI,aAAa,YAAY,GAAG;AACnE,QAAM,kBAAkB,IAAI,OAAO,KAAK,aAAa,KAAK,GAAG;AAE7D,QAAM,iBAAiB,CAAC,UAAkB,mBAAmB,OAAO,WAAW,UAAU;AAEzF,SAAO,OACJ,QAAQ,iBAAiB,CAAC,GAAG,UAAU,IAAI,OAAO,GAAG,eAAe,KAAK,CAAC,GAAG,EAC7E,QAAQ,iBAAiB,KAAK,OAAO,GAAG;AAC7C;AAEA,SAAS,mBAAmB,QAAgB,eAAuB,SAAiB,WAAmB,YAAsB,CAAC,GAAW;AACvI,QAAM,QAAQ,IAAI,OAAO,IAAI,aAAa,aAAa,GAAG;AAC1D,SAAO,OAAO,QAAQ,OAAO,CAAC,GAAG,UAAU;AACzC,UAAM,SAAS,mBAAmB,OAAO,WAAW,CAAC,GAAG,SAAS;AACjE,WAAO,IAAI,OAAO,GAAG,MAAM,MAAM,OAAO;AAAA,EAC1C,CAAC;AACH;AAEA,SAAS,mBAAmB,OAAe,WAAmB,aAAuB,CAAC,GAAG,UAA6B;AACpH,QAAM,SAAS,gBAAgB,SAAS,EAAE;AAE1C,aAAW,OAAO,YAAY;AAC5B,WAAO,OAAO,GAAG;AAAA,EACnB;AAEA,MAAI,YAAY,SAAS,SAAS,GAAG;AACnC,eAAW,OAAO,OAAO,KAAK,MAAM,GAAG;AACrC,UAAI,CAAC,SAAS,SAAS,GAAG,GAAG;AAC3B,eAAO,OAAO,GAAG;AAAA,MACnB;AAAA,IACF;AAAA,EACF;AAEA,QAAM,UAAoB,CAAC,SAAS;AACpC,MAAI,OAAO,WAAW;AACpB,YAAQ,KAAK,GAAG,aAAa,OAAO,SAAS,CAAC;AAC9C,WAAO,OAAO;AAAA,EAChB;AACA,MAAI,OAAO,OAAO;AAChB,YAAQ,KAAK,GAAG,aAAa,OAAO,KAAK,CAAC;AAC1C,WAAO,OAAO;AAAA,EAChB;AAEA,QAAM,YAAY,OAAO,QAAQ,MAAM,EACpC,IAAI,CAAC,CAAC,KAAK,KAAK,MAAM,GAAG,GAAG,KAAK,gBAAgB,KAAK,CAAC,GAAG,EAC1D,KAAK,GAAG;AAEX,SAAO,WAAW,QAAQ,OAAO,OAAO,EAAE,KAAK,GAAG,CAAC,IAAI,YAAY,IAAI,SAAS,KAAK,EAAE;AACzF;AAEA,SAAS,gBAAgB,QAAwC;AAC/D,QAAM,QAAgC,CAAC;AACvC,QAAM,QAAQ;AACd,MAAI;AACJ,SAAQ,QAAQ,MAAM,KAAK,MAAM,GAAI;AACnC,UAAM,CAAC,EAAE,KAAK,QAAQ,IAAI;AAC1B,UAAM,GAAG,IAAI,qBAAqB,QAAQ;AAAA,EAC5C;AACA,SAAO;AACT;AAEA,SAAS,qBAAqB,OAAuB;AACnD,QAAM,UAAU,MAAM,KAAK;AAC3B,MAAI,CAAC,QAAS,QAAO;AACrB,MAAK,QAAQ,WAAW,GAAG,KAAK,QAAQ,SAAS,GAAG,KAAO,QAAQ,WAAW,GAAG,KAAK,QAAQ,SAAS,GAAG,GAAI;AAC5G,WAAO,QAAQ,MAAM,GAAG,EAAE,EAAE,KAAK;AAAA,EACnC;AACA,MAAK,QAAQ,WAAW,GAAG,KAAK,QAAQ,SAAS,GAAG,KAAO,QAAQ,WAAW,GAAG,KAAK,QAAQ,SAAS,GAAG,GAAI;AAC5G,WAAO,QAAQ,MAAM,GAAG,EAAE;AAAA,EAC5B;AACA,SAAO;AACT;AAEA,SAAS,aAAa,OAAqC;AACzD,MAAI,CAAC,MAAO,QAAO,CAAC;AACpB,SAAO,MACJ,QAAQ,YAAY,GAAG,EACvB,MAAM,KAAK,EACX,OAAO,OAAO;AACnB;AAEA,SAAS,gBAAgB,OAAuB;AAC9C,SAAO,MACJ,QAAQ,MAAM,OAAO,EACrB,QAAQ,MAAM,QAAQ,EACtB,QAAQ,MAAM,MAAM,EACpB,QAAQ,MAAM,MAAM;AACzB;AAEA,SAAS,eAAe,QAAwB;AAC9C,SAAO,OACJ,QAAQ,+BAA+B,EAAE,EACzC,QAAQ,8BAA8B,EAAE,EACxC,QAAQ,8BAA8B,EAAE,EACxC,QAAQ,gCAAgC,EAAE,EAC1C,QAAQ,qBAAqB,EAAE,EAC/B,QAAQ,mBAAmB,EAAE,EAC7B,QAAQ,mBAAmB,EAAE;AAClC;",
  "names": []
}
